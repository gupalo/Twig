``use``
=======

.. note::

    Горизонтальное повторное использование - это продвинутая функция Twig, 
    которая почти никогда не требуется в обычных шаблонах. В основном она 
    используется в проектах, где нужно сделать блоки шаблонов многоразовыми
    без использования наследования.

Наследование шаблонов - одна из самых мощных возможностей Twig, но она ограничена одним
наследованием; шаблон может расширять только один другой шаблон. Это ограничение делает
наследование шаблонов простым для понимания и легким для отладки:

.. code-block:: twig

    {% extends "base.html" %}

    {% block title %}{% endblock %}
    {% block content %}{% endblock %}

Горизонтальное повторное использование - это способ достичь той же цели, что и множественное
наследование, но без связанных с этим сложностей:

.. code-block:: twig

    {% extends "base.html" %}

    {% use "blocks.html" %}

    {% block title %}{% endblock %}
    {% block content %}{% endblock %}

Утверждение ``use`` указывает Twig импортировать блоки, определенные в файле ``blocks.html``
в текущий шаблон (это как макросы, но для блоков):

.. code-block:: twig

    {# blocks.html #}
    
    {% block sidebar %}{% endblock %}

В этом примере утверждение ``use`` импортирует блок ``sidebar`` в 
основной шаблон. Код в основном эквивалентен следующему (импортированные блоки
не выводятся автоматически):

.. code-block:: twig

    {% extends "base.html" %}

    {% block sidebar %}{% endblock %}
    {% block title %}{% endblock %}
    {% block content %}{% endblock %}

.. note::

    Тег ``use`` импортирует шаблон только в том случае, если он не расширяет другой 
    шаблон, если он не определяет макросы и если тело шаблона пустое. Но он
    может *использовать* другие шаблоны.

.. note::

    Поскольку утверждение ``use`` решается независимо от контекста, 
    переданного шаблону, ссылка на шаблон не может быть выражением.

Основной шаблон также может переопределять любой импортированный блок. Если шаблон
уже определяет блок ``sidebar``, то блок, определенный в файле ``blocks.html``,
игнорируется. Чтобы избежать конфликтов имен, вы можете переименовывать импортируемые блоки:

.. code-block:: twig

    {% extends "base.html" %}

    {% use "blocks.html" with sidebar as base_sidebar, title as base_title %}

    {% block sidebar %}{% endblock %}
    {% block title %}{% endblock %}
    {% block content %}{% endblock %}

Функция ``parent()`` автоматически определяет корректное дерево наследования, поэтому ее можно
использовать при переопределении блока, определенного в импортированном шаблоне:

.. code-block:: twig

    {% extends "base.html" %}

    {% use "blocks.html" %}

    {% block sidebar %}
        {{ parent() }}
    {% endblock %}

    {% block title %}{% endblock %}
    {% block content %}{% endblock %}

В этом примере ``parent()`` корректно вызовет блок ``sidebar`` из
шаблона ``blocks.html``.

.. tip::

    Переименование позволяет имитировать наследование путем вызова "родительского" блока:

    .. code-block:: twig

        {% extends "base.html" %}

        {% use "blocks.html" with sidebar as parent_sidebar %}

        {% block sidebar %}
            {{ block('parent_sidebar') }}
        {% endblock %}

.. note::

    Вы можете использовать сколько угодно утверждений ``use`` в любом
    предоставленном шаблоне. Если два импортируемых шаблона определяют
    один и тот же блок, выигрывает последний.
